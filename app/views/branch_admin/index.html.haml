%h2
  = @group.name
  = @group.is_conference_group? ? "Registrants" : "Members"

=link_to_unless_current "Current Members", branch_admin_path(params[:group_id])
%br
-if params[:group_id].to_i == NzffaSettings.fft_marketplace_group_id
  =link_to_unless_current "Past FFT members", branch_admin_past_fft_members_path
-elsif !@group.is_conference_group?
  =link_to_unless_current "Past Members - all", branch_admin_past_members_path(params[:group_id])
  %br
  =link_to_unless_current "Past Members - last year only", branch_admin_last_year_members_path(params[:group_id])
%br

=link_to "Email current members", branch_admin_email_path(params[:group_id])
%br

=link_to "Download CSV (for Excel)", url_for(:format => :csv)
%br
- if @group.is_conference_group?
  = link_to "Download CSV of all conference members (not just this group)", url_for(:controller => :conference_subscriptions, :action => :index, :format => :csv)
  %br
  = link_to "Find a member to register for the conference", :invite_conference_subscriptions
  
%table{:class => 'px1'}
  %thead
    %th nzffa id
    %th Name
    %th Email
    %th{:style => 'width: 100px'} Phone
    %th Address
    - if @group.is_conference_group?
      %th Registered for
      %th Paid by
      %th Date paid
      %th # Reg.
      %th Levy
      %th Notes
    %th Edit
  %tbody
    -@readers.sort {|a,b| a.surname.to_s <=> b.surname.to_s }.each do |reader|
      %tr
        %td=reader.nzffa_membership_id
        %td=reader.name
        %td=reader.email
        %td
          =raw [reader.phone, reader.mobile].select{|f| f.present?}.join('<br>')
        %td
          =raw reader.postal_address_array.select{|f| f.present?}.join('<br>')
        - if @group.is_conference_group?
          %td=reader.groups.select{|g| g.ancestors.include?(conference_group)}.map{|g| link_to g.name, branch_admin_path(g)}.join ", "
          - if reader.conference_subscription
            %td= reader.conference_subscription.payment_method
            %td= reader.conference_subscription.paid_at.strftime("%d %B %H:%M")
            %td= reader.conference_subscription.single_or_couple == 'couple' ? 2 : 1
            %td= number_to_currency reader.conference_subscription.levy
            %td= reader.conference_subscription.notes
          - else
            %td{:colspan => 5} "Not subscribed"
        %td
          =link_to('Edit', branch_admin_edit_path(params[:group_id], reader.nzffa_membership_id))
          - if reader.conference_subscription
            = link_to('Delete', conference_subscription_path(reader.conference_subscription.id), :confirm => "There is no way to undo this.. are you REALLY sure you want to delete this conference subscription?", :method => :delete )
          
